<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宮本研面談予約システム</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="background-decor"></div>
    <header class="app-header">
        <div class="container">
            <h1>宮本研面談予約システム</h1>
            <p class="subtitle">Miyamoto Lab Interview Reservation System</p>
        </div>
    </header>

    <main class="container main-content">
        <!-- Dashboard / Sidebar -->
        <aside class="dashboard-sidebar">
            <h3>
                <i class="fas fa-bookmark" style="margin-right:0.5rem;"></i>予約状況ピックアップ
            </h3>

            <!-- Today -->
            <div class="dashboard-section">
                <h4>今日の予約</h4>
                <div id="dashboardTodayList" class="dashboard-list">読み込み中...</div>
            </div>

            <!-- This Week -->
            <div class="dashboard-section">
                <h4>今週の予約 (以降)</h4>
                <div id="dashboardWeekList" class="dashboard-list">読み込み中...</div>
            </div>
        </aside>

        <!-- Calendar Section (Existing) -->
        <section class="calendar-section">
            <div class="calendar-header">
                <button id="prevMonth" class="nav-btn"><i class="fas fa-chevron-left"></i></button>
                <h2 id="currentMonthDisplay">2026年 1月</h2>
                <button id="nextMonth" class="nav-btn"><i class="fas fa-chevron-right"></i></button>
            </div>

            <div class="admin-controls-area">
                <button id="adminToggleBtn" class="text-btn">管理者モード: OFF</button>
                <button id="allReservationsBtn" class="text-btn" style="display:none; margin-left: 1rem;">全予約確認</button>
                <button id="batchRegistrationBtn" class="text-btn"
                    style="display:none; margin-left: 1rem;">一括登録</button>
                <button id="ownerManagementBtn" class="text-btn"
                    style="display:none; margin-left: 1rem;">オーナー管理</button>
            </div>

            <div class="calendar-grid" id="calendarGrid">
                <!-- Day headers will be injected here -->
                <!-- Dates will be injected here -->
            </div>

            <div class="calendar-legend">
                <div class="legend-item"><span class="dot available"></span>予約可能</div>
                <div class="legend-item"><span class="dot few"></span>残りわずか</div>
                <div class="legend-item"><span class="dot full"></span>満席</div>
            </div>
        </section>
    </main>

    <!-- Reservation Modal -->
    <div id="reservationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalDateTitle">予約情報の入力</h3>
                <button class="close-btn closeModal"><i class="fas fa-times"></i></button>
            </div>
            <!-- Schedule View (Step 1) -->
            <div id="bookingScheduleView">
                <p style="margin-bottom: 1rem; font-size: 0.9rem; color: #666;">
                    希望の時間帯を選択してください。<br>
                    <span style="font-size: 0.8rem;">※ すでに予約が入っている枠には予約者名が表示されます。</span>
                </p>
                <div id="dailyScheduleList" class="schedule-list">
                    <!-- Dynamically generated slots -->
                </div>
            </div>

            <!-- Booking Form (Step 2) -->
            <div id="bookingFormContainer" style="display: none;">
                <button type="button" id="backToScheduleBtn" class="text-btn"
                    style="margin-bottom: 1rem; padding-left: 0;">
                    <i class="fas fa-arrow-left"></i> 日程選択に戻る
                </button>
                <form id="reservationForm">
                    <div class="form-group">
                        <label for="name">氏名</label>
                        <input type="text" id="name" name="name" required placeholder="宮本 太郎">
                    </div>
                    <div class="form-group">
                        <label for="studentId">学籍番号</label>
                        <input type="text" id="studentId" name="studentId" required placeholder="00X0000">
                    </div>
                    <div class="form-group">
                        <label for="email">メールアドレス (通知送付先: 任意)</label>
                        <input type="email" id="email" name="email" placeholder="student@university.ac.jp">
                    </div>
                    <div class="form-group">
                        <label for="attendees">参加人数 (本人含む)</label>
                        <input type="number" id="attendees" name="attendees" min="1" value="1" required>
                    </div>

                    <!-- Dynamic Fields for Additional Attendees -->
                    <div id="additionalAttendeesContainer"
                        style="margin-top: 1rem; padding-left: 1rem; border-left: 2px solid #e2e8f0;">
                        <!-- JS will populate: Name, StudentID, Email for each extra person -->
                    </div>
                    <div class="form-group">
                        <label for="format">希望形式</label>
                        <select id="format" name="format">
                            <option value="presential">対面</option>
                            <option value="remote">リモート (Zoom/Teams)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="duration">所要時間</label>
                        <select id="duration" name="duration">
                            <option value="1">30分</option>
                            <option value="2">60分</option>
                            <option value="3">90分</option>
                            <option value="4">120分</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="selectedTimeDisplay">日時</label>
                        <input type="text" id="selectedTimeDisplay" readonly
                            style="background-color: #f7fafc; border: none; font-weight: bold; color: var(--color-primary);">
                        <input type="hidden" id="timeSlot" name="timeSlot" required>
                    </div>
                    <div class="form-group">
                        <label for="type">面談内容</label>
                        <select id="type" name="type">
                            <option value="research">研究相談</option>
                            <option value="report">進捗報告</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>面談の公開設定</label>
                        <div style="display: flex; gap: 1rem; margin-top: 0.25rem;">
                            <label style="font-weight: normal; cursor: pointer;">
                                <input type="radio" name="privacyType" value="private" checked> 1対1 (個別)
                            </label>
                            <label style="font-weight: normal; cursor: pointer;">
                                <input type="radio" name="privacyType" value="open"> 他の学生の同席を許可
                            </label>
                        </div>
                        <p style="font-size: 0.8rem; color: #718096; margin-top: 4px;">
                            ※「同席を許可」を選択すると、同じ時間に他の学生も予約できるようになります。
                        </p>
                    </div>
                    <!-- Previously Attendees were here, now moved up -->

                    <div class="actions">
                        <button type="submit" class="submit-btn">予約する</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Day Management Modal -->
    <div id="adminDayModal" class="modal">
        <div class="modal-content admin-modal">
            <div class="modal-header">
                <h3 id="adminDateTitle">管理者設定</h3>
                <button class="close-btn closeModal"><i class="fas fa-times"></i></button>
            </div>

            <div class="admin-section">
                <h4>予約枠の管理</h4>
                <!-- Range Selector -->
                <div
                    style="background: #f7fafc; padding: 0.8rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid #e2e8f0;">
                    <div style="font-size: 0.85rem; margin-bottom: 0.5rem; color: #4a5568; font-weight: 600;">
                        範囲指定で追加（一括チェック）</div>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <select id="dailyBatchStartTime"
                            style="padding: 0.4rem; border-radius: 4px; border: 1px solid #cbd5e0; font-size: 0.9rem; flex:1;"></select>
                        <span style="color: #718096;">～</span>
                        <select id="dailyBatchEndTime"
                            style="padding: 0.4rem; border-radius: 4px; border: 1px solid #cbd5e0; font-size: 0.9rem; flex:1;"></select>
                        <button id="dailyBatchApplyBtn" type="button"
                            style="background: var(--color-primary); color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 4px; cursor: pointer; font-size: 0.85rem; white-space: nowrap;">反映</button>
                    </div>
                </div>

                <p class="admin-hint">チェックを入れた枠が「予約可能」になります。</p>
                <div id="adminTimeSlots" class="admin-slots-grid">
                    <!-- Checkboxes generated dynamically -->
                </div>
            </div>

            <div class="admin-section">
                <h4>現在の予約一覧</h4>
                <ul id="adminReservationsList" class="reservation-list">
                    <!-- List items generated dynamically -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Password Login Modal -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>管理者認証</h3>
                <button class="close-btn closeModal"><i class="fas fa-times"></i></button>
            </div>
            <form id="passwordForm">
                <div class="form-group">
                    <label for="adminUserSelect">ログインユーザー</label>
                    <select id="adminUserSelect"
                        style="width: 100%; padding: 0.8rem; border: 1px solid var(--color-border); border-radius: 8px; margin-bottom: 1rem;">
                        <!-- Options generated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="adminPassword">パスワードを入力してください</label>
                    <input type="password" id="adminPassword" required>
                </div>
                <div class="actions">
                    <button type="submit" class="submit-btn" id="loginSubmitBtn">ログイン</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>パスワード変更</h3>
                <button class="close-btn closeModal"><i class="fas fa-times"></i></button>
            </div>
            <form id="changePasswordForm">
                <div class="form-group">
                    <label for="currentPasswordInput">現在のパスワード</label>
                    <input type="password" id="currentPasswordInput" required>
                </div>
                <div class="form-group">
                    <label for="newPasswordInput">新しいパスワード</label>
                    <input type="password" id="newPasswordInput" required>
                </div>
                <div class="actions">
                    <button type="submit" class="submit-btn">変更する</button>
                </div>
            </form>
        </div>
    </div>

    <!-- All Reservations Modal -->
    <div id="allReservationsModal" class="modal">
        <div class="modal-content admin-modal">
            <div class="modal-header">
                <h3>全予約一覧</h3>
                <button class="close-btn closeModal"><i class="fas fa-times"></i></button>
            </div>
            <div class="admin-section">
                <div class="filter-options" style="margin-bottom: 1rem; text-align: right;">
                    <button id="copyAllDataBtn" class="text-btn" style="font-size: 0.8rem;">データをコピー</button>
                </div>
                <ul id="allReservationsList" class="reservation-list" style="max-height: 400px;">
                    <!-- List items generated dynamically -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Owner Management Modal -->
    <div id="ownerManagementModal" class="modal">
        <div class="modal-content admin-modal">
            <div class="modal-header">
                <h3>オーナー情報管理</h3>
                <button class="close-btn closeModal"><i class="fas fa-times"></i></button>
            </div>

            <!-- Add New Owner Form -->
            <div class="admin-section"
                style="border-bottom: 1px solid var(--color-border); padding-bottom: 1.5rem; margin-bottom: 1.5rem;">
                <h4>新規登録</h4>
                <form id="addOwnerForm">
                    <div class="form-group" style="margin-bottom: 0.8rem;">
                        <input type="text" id="ownerName" placeholder="氏名" required
                            style="padding: 0.5rem; font-size: 0.9rem;">
                    </div>
                    <div class="form-group"
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.8rem;">
                        <select id="ownerStatus" style="padding: 0.5rem; font-size: 0.9rem;">
                            <option value="admin">システム管理者</option>
                            <option value="faculty">教員</option>
                            <option value="student_undergrad">学部生</option>
                            <option value="student_master">院生</option>
                        </select>
                        <div
                            style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border: 1px solid var(--color-border); border-radius: 8px; background: #fff;">
                            <input type="checkbox" id="ownerNotify" style="width: auto;" checked>
                            <label for="ownerNotify"
                                style="margin: 0; font-size: 0.9rem; cursor: pointer;">通知を受け取る</label>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0.8rem;">
                        <input type="email" id="ownerEmail" placeholder="メールアドレス" required
                            style="padding: 0.5rem; font-size: 0.9rem;">
                    </div>
                    <div class="form-group" style="margin-bottom: 0.8rem;">
                        <input type="password" id="ownerPassword" placeholder="パスワード (ログイン用)" required
                            style="padding: 0.5rem; font-size: 0.9rem;">
                    </div>
                    <button type="submit" class="submit-btn" style="padding: 0.5rem; font-size: 0.9rem;">追加する</button>
                </form>
            </div>

            <!-- Existing Owners List -->
            <div class="admin-section">
                <h4>登録済みオーナー一覧</h4>
                <ul id="ownerList" class="reservation-list" style="max-height: 250px;">
                    <!-- List items generated dynamically -->
                </ul>
            </div>

            <!-- Password Change Shortcut -->
            <div class="admin-section"
                style="margin-top: 2rem; border-top: 1px solid var(--color-border); padding-top: 1rem;">
                <h4>セキュリティ</h4>
                <button id="changePasswordBtn" class="text-btn" style="color: var(--color-primary); font-weight: 500;">
                    <i class="fas fa-key"></i> ログイン中のパスワードを変更する
                </button>
            </div>
        </div>
    </div>

    <!-- Batch Registration Modal -->
    <div id="batchRegistrationModal" class="modal">
        <div class="modal-content admin-modal">
            <div class="modal-header">
                <h3>予約枠の一括登録</h3>
                <button class="close-btn closeModal"><i class="fas fa-times"></i></button>
            </div>
            <form id="batchRegistrationForm">
                <div class="admin-section">
                    <h4>1. 期間設定</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="batchStartDate">開始日</label>
                            <input type="date" id="batchStartDate" required>
                        </div>
                        <div class="form-group">
                            <label for="batchEndDate">終了日</label>
                            <input type="date" id="batchEndDate" required>
                        </div>
                    </div>
                </div>

                <div class="admin-section">
                    <h4>2. 曜日選択</h4>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <label><input type="checkbox" name="batchDay" value="1"> 月</label>
                        <label><input type="checkbox" name="batchDay" value="2"> 火</label>
                        <label><input type="checkbox" name="batchDay" value="3"> 水</label>
                        <label><input type="checkbox" name="batchDay" value="4"> 木</label>
                        <label><input type="checkbox" name="batchDay" value="5"> 金</label>
                        <label><input type="checkbox" name="batchDay" value="6"> 土</label>
                        <label><input type="checkbox" name="batchDay" value="0"> 日</label>
                    </div>
                </div>

                <div class="admin-section">
                    <h4>3. 時間帯設定</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label for="batchStartTime">開始時間</label>
                            <select id="batchStartTime">
                                <!-- Options populated by JS -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="batchEndTime">終了時間</label>
                            <select id="batchEndTime">
                                <!-- Options populated by JS -->
                            </select>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <button type="submit" class="submit-btn">一括登録する</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification/Toast -->
    <div id="toast" class="toast">予約が完了しました</div>

    <script src="script.js"></script>
</body>

</html>